import React from 'react';
import { AuditResult, Vulnerability } from '../types';
import { AlertTriangle, ShieldCheck, AlertOctagon, Info, AlertCircle } from 'lucide-react';

interface Props {
  result: AuditResult;
}

export const VulnerabilityReport: React.FC<Props> = ({ result }) => {
  return (
    <div className="p-6 space-y-8">
      
      {/* Summary Section */}
      <section>
        <h3 className="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Executive Summary</h3>
        <div className={`p-4 rounded-lg border ${result.isScam ? 'bg-red-950/30 border-red-900' : 'bg-gray-800/50 border-gray-700'}`}>
          <div className="flex items-start gap-3">
             {result.isScam ? <AlertOctagon className="w-6 h-6 text-red-500 shrink-0 mt-0.5" /> : <ShieldCheck className="w-6 h-6 text-emerald-500 shrink-0 mt-0.5" />}
             <div>
               <h4 className={`text-lg font-bold mb-1 ${result.isScam ? 'text-red-400' : 'text-emerald-400'}`}>
                 {result.isScam ? 'Critical Security Threat' : 'Analysis Complete'}
               </h4>
               <p className="text-gray-300 text-sm leading-relaxed">
                 {result.summary}
               </p>
             </div>
          </div>
        </div>
      </section>

      {/* Vulnerabilities List */}
      <section>
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-sm font-bold text-gray-500 uppercase tracking-wider">Findings ({result.vulnerabilities.length})</h3>
        </div>
        
        <div className="space-y-3">
          {result.vulnerabilities.length === 0 ? (
            <div className="text-gray-500 text-sm italic">No significant vulnerabilities found.</div>
          ) : (
            result.vulnerabilities.map((vuln, idx) => (
              <VulnerabilityCard key={idx} data={vuln} />
            ))
          )}
        </div>
      </section>
    </div>
  );
};

const VulnerabilityCard: React.FC<{ data: Vulnerability }> = ({ data }) => {
  const getSeverityStyles = (sev: string) => {
    switch (sev) {
      case 'CRITICAL': return { bg: 'bg-red-500/10', border: 'border-red-500/50', text: 'text-red-400', icon: AlertOctagon };
      case 'HIGH': return { bg: 'bg-orange-500/10', border: 'border-orange-500/50', text: 'text-orange-400', icon: AlertTriangle };
      case 'MEDIUM': return { bg: 'bg-yellow-500/10', border: 'border-yellow-500/50', text: 'text-yellow-400', icon: AlertCircle };
      default: return { bg: 'bg-blue-500/10', border: 'border-blue-500/50', text: 'text-blue-400', icon: Info };
    }
  };

  const styles = getSeverityStyles(data.severity);
  const Icon = styles.icon;

  return (
    <div className={`rounded-md border ${styles.border} ${styles.bg} p-4 transition-all hover:bg-opacity-20`}>
      <div className="flex items-start justify-between">
        <div className="flex items-center gap-2 mb-2">
           <Icon className={`w-4 h-4 ${styles.text}`} />
           <span className={`text-xs font-bold px-2 py-0.5 rounded bg-black/20 ${styles.text}`}>{data.severity}</span>
           <span className="text-sm font-medium text-gray-200">{data.type}</span>
        </div>
        {data.line && <span className="text-xs font-mono text-gray-500">Ln {data.line}</span>}
      </div>
      <p className="text-sm text-gray-300 mt-1">{data.description}</p>
    </div>
  );
};